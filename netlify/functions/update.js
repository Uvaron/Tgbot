const { exec } = require('child_process');
const path = require('path');
const cFilePath = path.join(__dirname, '../tictactoe');
const sendMessage = require("../../sendMessage");
const messageParts = require("../../messageParts");

const queens = [
  { text: "üá™üá∏ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ò—Å–ø–∞–Ω–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç–≤–æ–µ –ø–ª–∞—Ç—å–µ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è, –≤—Å–µ –±—ã–∫–∏ –ø–∞–¥–∞—é—Ç –≤ –æ–±–º–æ—Ä–æ–∫." },
  { text: "üáØüáµ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –Ø–ø–æ–Ω–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã –≤—ã—Ö–æ–¥–∏—à—å –Ω–∞ —É–ª–∏—Ü—É, —Ü–≤–µ—Ç—ã —Å–∞–∫—É—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç —Ü–≤–µ—Å—Ç–∏, –∞ —Å–∞–º—É—Ä–∞–∏ —É—Å—Ç—Ä–∞–∏–≤–∞—é—Ç —Ç–∞–Ω–µ—Ü –≤ —Ç–≤–æ—é —á–µ—Å—Ç—å." },
  { text: "üá™üá¨ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ï–≥–∏–ø—Ç–∞ ‚Äî —Ç–≤–æ—è —É–ª—ã–±–∫–∞ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –ø–∏—Ä–∞–º–∏–¥—ã —Å–≤–µ—Ç–∏—Ç—å—Å—è –≤ —Ç–µ–º–Ω–æ—Ç–µ, –∞ –ù–∏–ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø–æ–ª—é–±–æ–≤–∞—Ç—å—Å—è —Ç–æ–±–æ–π." },
  { text: "üáßüá∑ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ë—Ä–∞–∑–∏–ª–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã —Ç–∞–Ω—Ü—É–µ—à—å —Å–∞–º–±—É, –¥–∞–∂–µ –¥–µ–ª—å—Ñ–∏–Ω—ã –≤—ã—Ö–æ–¥—è—Ç –Ω–∞ –±–µ—Ä–µ–≥, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ç–≤–æ–µ –≤–µ–ª–∏–∫–æ–ª–µ–ø–∏–µ." },
  { text: "üáÆüáπ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ò—Ç–∞–ª–∏–∏ ‚Äî —Ç–≤–æ—è –∫—Ä–∞—Å–æ—Ç–∞ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —à–µ–¥–µ–≤—Ä–æ–≤, –∞ –ø–∏—Ü—Ü–∞ —Å–∞–º–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫ —Ç–≤–æ–∏–º –Ω–æ–≥–∞–º." },
  { text: "üáÆüá≥ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ò–Ω–¥–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã –ø—Ä–æ—Ö–æ–¥–∏—à—å –º–∏–º–æ, —Å–ª–æ–Ω—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, —á—Ç–æ–±—ã –ø–æ–∫–ª–æ–Ω–∏—Ç—å—Å—è —Ç–≤–æ–µ–º—É –≤–µ–ª–∏—á–∏—é, –∞ —Ü–≤–µ—Ç—ã —Ä–∞–¥—É–≥–∏ —Ä–∞—Å—Ü–≤–µ—Ç–∞—é—Ç –≤–æ–∫—Ä—É–≥." },
  { text: "üá´üá∑ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –§—Ä–∞–Ω—Ü–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã –≤—Ö–æ–¥–∏—à—å –≤ –õ—É–≤—Ä, –≤—Å–µ –∫–∞—Ä—Ç–∏–Ω—ã –Ω–∞—á–∏–Ω–∞—é—Ç —É–ª—ã–±–∞—Ç—å—Å—è, –∞ –≠–π—Ñ–µ–ª–µ–≤–∞ –±–∞—à–Ω—è —Å–≤–µ—Ç–∏—Ç—Å—è –≤ —Ç–≤–æ—é —á–µ—Å—Ç—å." },
  { text: "üá∑üá∫ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –†–æ—Å—Å–∏–∏ ‚Äî —Ç–≤–æ–π –≤–∑–≥–ª—è–¥ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–Ω–µ–∂–Ω—ã–µ –≤–µ—Ä—à–∏–Ω—ã —Ç–∞—è—Ç—å, –∞ –º–µ–¥–≤–µ–¥–∏ —Ç–∞–Ω—Ü—É—é—Ç –ø–æ–¥ –±–∞–ª–∞–ª–∞–π–∫—É." },
  { text: "üá¶üá∫ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ê–≤—Å—Ç—Ä–∞–ª–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã –≤—ã—Ö–æ–¥–∏—à—å –Ω–∞ –ø–ª—è–∂, —Å–æ–ª–Ω—Ü–µ —è—Ä—á–µ —Å–≤–µ—Ç–∏—Ç, –∞ –∫–µ–Ω–≥—É—Ä—É —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –∫—Ä—É–≥, —á—Ç–æ–±—ã —Å–ª—É—à–∞—Ç—å —Ç–≤–æ–∏ –∏—Å—Ç–æ—Ä–∏–∏." },
  { text: "üá®üá≥ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ö–∏—Ç–∞—è ‚Äî —Ç–≤–æ–π —à–∞–≥ –≤—ã–∑—ã–≤–∞–µ—Ç –≤–æ–ª–Ω—ã –≤–æ—Å—Ç–æ—Ä–≥–∞, –∞ –¥—Ä–∞–∫–æ–Ω—ã –ª–µ—Ç–∞—é—Ç –Ω–∞–¥ –≥–æ—Ä–æ–¥–∞–º–∏, –æ—Ö—Ä–∞–Ω—è—è —Ç–≤–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ." },
  { text: "üá¨üá∑ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ì—Ä–µ—Ü–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã —Å–º–µ–µ—à—å—Å—è, –¥—Ä–µ–≤–Ω–∏–µ —Ö—Ä–∞–º—ã –Ω–∞—á–∏–Ω–∞—é—Ç –ø–µ—Ç—å, –∞ –æ–ª–∏–≤—ã –ø—Ä–∏–Ω–æ—Å—è—Ç –ø–ª–æ–¥—ã –≤ —Ç–≤–æ—é —á–µ—Å—Ç—å." },
  { text: "üá≤üáΩ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ú–µ–∫—Å–∏–∫–∏ ‚Äî —Ç–≤–æ–π —Å–º–µ—Ö –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–∞–¥–æ—Å—Ç—å —É –≤—Å–µ—Ö –≤–æ–∫—Ä—É–≥, –∞ –∫–∞–∫—Ç—É—Å—ã —Ü–≤–µ—Ç—É—Ç —è—Ä—á–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–±—è." },
  { text: "üá∏üá™ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –®–≤–µ—Ü–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã –ø—Ä–æ—Ö–æ–¥–∏—à—å –º–∏–º–æ, —Å–µ–≤–µ—Ä–Ω–æ–µ —Å–∏—è–Ω–∏–µ —Ä–∞—Å—Ü–≤–µ—Ç–∞–µ—Ç –≤ –Ω–µ–±–µ—Å–∞—Ö, –∞ –≤—Å–µ —Ñ—å–æ—Ä–¥—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, —á—Ç–æ–±—ã –ø–æ–ª—é–±–æ–≤–∞—Ç—å—Å—è." },
  { text: "üá≥üá¥ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ù–æ—Ä–≤–µ–≥–∏–∏ ‚Äî —Ç–≤–æ–π –≥–æ–ª–æ—Å –∑–≤—É—á–∏—Ç –∫–∞–∫ –≤–µ—Ç–µ—Ä –≤ –≥–æ—Ä–∞—Ö, –∞ –ª–æ–¥–∫–∏ –Ω–∞ —Ñ—å–æ—Ä–¥–∞—Ö –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å —Ç–≤–æ–∏ —Å–ª–æ–≤–∞." },
  { text: "üáπüá∑ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –¢—É—Ä—Ü–∏–∏ ‚Äî –∫–æ–≥–¥–∞ —Ç—ã –≤—Ö–æ–¥–∏—à—å –≤ –º–µ—á–µ—Ç—å, —Å–≤–µ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å, –∞ –≤—Å–µ —Ü–≤–µ—Ç–∞ –ø—Ä—è–Ω–æ—Å—Ç–µ–π —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —è—Ä—á–µ." },
  { text: "üá®üá¶ –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ –ö–∞–Ω–∞–¥—ã ‚Äî —Ç–≤–æ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç —É–ª—ã–±–∫–∏ —É –º–µ–¥–≤–µ–¥–µ–π –∏ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª–µ–Ω–æ–≤—ã–µ –ª–∏—Å—Ç—å—è —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å –≤ –≤–æ–∑–¥—É—Ö–µ." }
];

exports.handler = async (event) => {
  let message;

  // –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å JSON –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  try {
    const body = JSON.parse(event.body);
    message = body.message;
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ JSON:", error);
    return { statusCode: 400, body: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞." };
  }

  if (!message || !message.text) {
    console.error("–°–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ —Ç–µ–∫—Å—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.");
    return { statusCode: 400, body: "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç." };
  }

  const { botName, command, extra } = messageParts(message.text);

  if (botName === "Queens_never_cry_bot" || botName === "Q") {
    switch (command) {
      case "Queens":
        const randomIndex = Math.floor(Math.random() * queens.length);
        const responseMessage = queens[randomIndex].text;
        await sendMessage(message.chat.id, responseMessage);
        break;
      case "Qecho":
        await sendMessage(message.chat.id, extra || "ECHO!");
        break;
      case "Qhelp":
        await sendMessage(message.chat.id, "–î–∞—Ä–æ–≤–∞, —è –ö–æ—Ä–æ–ª–µ–≤–∞–±–æ—Ç, –Ω–∞–ø–∏—à–∏ –º–Ω–µ –ª—é–±—É—é –∫–æ–º–∞–Ω–¥—É –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ —è —Å–µ–π—á–∞—Å –ø–µ—Ä–µ—á–∏—Å–ª—é –∏ –º—ã –Ω–∞—á–Ω—ë–º!");
        await sendMessage(message.chat.id, "/Qecho @Q - –¥–ª—è —ç—Ö–∞, /Queens @Q - —É–∑–Ω–∞–π, –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω—ã —Ç—ã –ö–æ—Ä–æ–ª–µ–≤–∞");
        break;
      case "Qgame":
        exec(cFilePath, (error, stdout, stderr) => {
    if (error) {
        console.error(`–û—à–∏–±–∫–∞: ${error.message}`);
        return;
    }
    if (stderr) {
        console.error(`–û—à–∏–±–∫–∞: ${stderr}`);
        return;
    }
    console.log(`–í—ã–≤–æ–¥: ${stdout}`);
});
        break;
      default:
        await sendMessage(message.chat.id, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞.");
    }
  }

  return { statusCode: 200 };
};
